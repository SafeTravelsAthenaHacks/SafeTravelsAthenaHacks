<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">
	//initializes map
	var map;
	var infoWindow;
	function initMap() {
		map = new google.maps.Map(document.getElementById('map'), {
	    	center: {lat: 34.02, lng: -118.285},
	      	zoom: 17
	    });
	    google.maps.event.addListener(map, 'click', function(event) {
	    	addMarker(event.latLng, map);
	    });
	    infoWindow = new google.maps.InfoWindow;

	      // Try HTML5 geolocation.
	      if (navigator.geolocation) {
	        navigator.geolocation.getCurrentPosition(function(position) {
	          var pos = {
	            lat: position.coords.latitude,
	            lng: position.coords.longitude
	          };

	          infoWindow.setPosition(pos);
	          infoWindow.setContent('Location found.');
	          infoWindow.open(map);
	          map.setCenter(pos);
	        }, function() {
	          handleLocationError(true, infoWindow, map.getCenter());
	        });
	      } else {
	        // Browser doesn't support Geolocation
	        handleLocationError(false, infoWindow, map.getCenter());
	      }
	      function initMap() {
	          var map = new google.maps.Map(document.getElementById('map'), {
	            center: {lat: -33.8688, lng: 151.2195},
	            zoom: 13
	          });
	          var card = document.getElementById('pac-card');
	          var input = document.getElementById('pac-input');
	          var types = document.getElementById('type-selector');
	          var strictBounds = document.getElementById('strict-bounds-selector');

	          map.controls[google.maps.ControlPosition.TOP_RIGHT].push(card);

	          var autocomplete = new google.maps.places.Autocomplete(input);

	          // Bind the map's bounds (viewport) property to the autocomplete object,
	          // so that the autocomplete requests use the current map bounds for the
	          // bounds option in the request.
	          autocomplete.bindTo('bounds', map);

	          // Set the data fields to return when the user selects a place.
	          autocomplete.setFields(
	              ['address_components', 'geometry', 'icon', 'name']);

	          var infowindow = new google.maps.InfoWindow();
	          var infowindowContent = document.getElementById('infowindow-content');
	          infowindow.setContent(infowindowContent);
	          var marker = new google.maps.Marker({
	            map: map,
	            anchorPoint: new google.maps.Point(0, -29)
	          });

	          autocomplete.addListener('place_changed', function() {
	            infowindow.close();
	            marker.setVisible(false);
	            var place = autocomplete.getPlace();
	            if (!place.geometry) {
	              // User entered the name of a Place that was not suggested and
	              // pressed the Enter key, or the Place Details request failed.
	              window.alert("No details available for input: '" + place.name + "'");
	              return;
	            }

	            // If the place has a geometry, then present it on a map.
	            if (place.geometry.viewport) {
	              map.fitBounds(place.geometry.viewport);
	            } else {
	              map.setCenter(place.geometry.location);
	              map.setZoom(17);  // Why 17? Because it looks good.
	            }
	            marker.setPosition(place.geometry.location);
	            marker.setVisible(true);

	            var address = '';
	            if (place.address_components) {
	              address = [
	                (place.address_components[0] && place.address_components[0].short_name || ''),
	                (place.address_components[1] && place.address_components[1].short_name || ''),
	                (place.address_components[2] && place.address_components[2].short_name || '')
	              ].join(' ');
	            }

	            infowindowContent.children['place-icon'].src = place.icon;
	            infowindowContent.children['place-name'].textContent = place.name;
	            infowindowContent.children['place-address'].textContent = address;
	            infowindow.open(map, marker);
	          });

	          // Sets a listener on a radio button to change the filter type on Places
	          // Autocomplete.
	          function setupClickListener(id, types) {
	            var radioButton = document.getElementById(id);
	            radioButton.addEventListener('click', function() {
	              autocomplete.setTypes(types);
	            });
	          }

	          setupClickListener('changetype-all', []);
	          setupClickListener('changetype-address', ['address']);
	          setupClickListener('changetype-establishment', ['establishment']);
	          setupClickListener('changetype-geocode', ['geocode']);

	          document.getElementById('use-strict-bounds')
	              .addEventListener('click', function() {
	                console.log('Checkbox clicked! New state=' + this.checked);
	                autocomplete.setOptions({strictBounds: this.checked});
	              });
	        }
	}
	
	
	function overlay() {
		document.getElementById("overlay").style.display = "block";
		document.getElementById("ExitButton").style.display = "block";
	}
	function help() {
		overlay();
		document.getElementById("Help").style.display = "block";
	}
	function directions() {
		overlay();
		document.getElementById("Directions").style.display = "block";
	}
	function danger() {
		overlay();
		document.getElementById("Danger").style.display = "block";
	}
	function question() {
		overlay();
		document.getElementById("Question").style.display = "block";
	}
	function exit() {
		document.getElementById("overlay").style.display = "none";
		document.getElementById("Help").style.display = "none";
		document.getElementById("Danger").style.display = "none";
		document.getElementById("Directions").style.display = "none";
		document.getElementById("Question").style.display = "none";
		document.getElementById("ExitButton").style.display = "none";
		
	}
	var slider = document.getElementById("myRange");
	var output = document.getElementById("demo");
	output.innerHTML = slider.value; // Display the default slider value

	// Update the current slider value (each time you drag the slider handle)
	slider.oninput = function() {
	  output.innerHTML = this.value;
	}

	

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
                            'Error: The Geolocation service failed.' :
                            'Error: Your browser doesn\'t support geolocation.');
      infoWindow.open(map);
    }
  </script>
	
</script>
<meta charset="UTF-8">
<title>Safe Travels</title>

<link rel="stylesheet" type="text/css" href="index.css" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet">
<link rel="manifest" href="/SafeTravelsAthenaHacks/manifest.json">
<link rel="shortcut icon" type="images/png" href="/SafeTravelsAthenaHacks/path.png"/>

</head>
<body>

<div class = "title">Safe Travels</div>

<button class="button" id="HelpButton" onclick = "help()">Help</button>
<div id ="overlay"></div>
<button class="button" id="DirectionsButton" onclick = "directions()">Directions</button>
<button class="button" id="DangerButton" onclick = "danger()">Danger</button>
<div class = "mapContainer"><div id = "map"></div></div>
<button class="QuestionButton" id ="QuestionMark" onclick = "question()">?</button>

<div id= "Help">If this is an emergency, please exit and call <a href= "tel: 911" style = "color: black;">911</a>.</br>
</br>If you feel like you are in danger, please download and use <a href = "https://play.google.com/store/apps/details?id=me.lyft.android&hl=en_US" style = "color:black;">Lyft</a>.
</br></br>Please also consider using <a href = "https://play.google.com/store/apps/details?id=com.safetrekapp.safetrek&hl=en_US" style = "color:black;">Noonlight</a> in a potentially dangerous situation.

</div>
<div id= "Directions">Please enter your start and end destinations.</br></br>
<form action="/SafeTravelsAthenaHacks/index.html">
<input type="text" value="Start" id = "StartSearch"></br></br>
<input type="text" value="Destination" id = "DestinationSearch">
</form>
</div>
<div id= "Danger">How dangerous is the area around you?</br></br>


<div class="slidecontainer">
  <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
</div>
<button class="button" id="SubmitButton" onclick = "exit()">Submit</button>
</div>
<div id= "Question">Click Help if you are in serious danger.</br>
</br>Click Directions if you need informed directions for the safest route to your destination.
</br></br>Click Danger to alert others of a potentially dangerous area.

</div>
<button class="ExitButton" id ="ExitButton" onclick = "exit()">X</button>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHFeFGiB5__HhJNndkjDfPb1f79lCDMMA&callback=initMap"
    async defer></script>

    
<script type="text/javascript" src="/SafeTravelsAthenaHacks/main.js" async></script>
<script type="text/javascript" src="/SafeTravelsAthenaHacks/service-worker.js" async></script>
</body>
</html>